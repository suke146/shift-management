# シフト管理システム

アルバイトのシフト提出・管理・閲覧ができるWebアプリケーションです。

## 機能

### 一般ユーザー
- ログイン/新規登録
- シフトの提出（**半月単位**: 1日～15日 / 16日～月末）
- 勤務時間は15分刻みで選択可能
- 確定シフトの閲覧（半月単位のカレンダー表示）

### 管理者
- 全ての一般ユーザー機能
- 全メンバーのシフト提出状況の確認
- 確定シフトの作成
- メンバー管理(権限変更、削除)

## 技術スタック

- **フロントエンド**: HTML5, CSS3, JavaScript (Vanilla)
- **バックエンド**: PHP 8.3+
- **データベース**: SQLite 3
- **デプロイ**: Railway.app (Docker)
- **その他**: セッション管理、レスポンシブデザイン

## セットアップ方法

### ローカル開発環境

#### 1. 必要な環境
- PHP 8.0以上（SQLite拡張が有効）
- Git

#### 2. プロジェクトのクローン

```bash
git clone https://github.com/suke146/shift-management.git
cd shift-management
```

#### 3. データベースの初期化

```bash
php init_db.php
```

これにより `data/shift_management.db` が作成され、テーブルとデフォルト管理者アカウントが作成されます。

#### 4. 開発サーバーの起動

```bash
php -S localhost:8000
```

ブラウザで `http://localhost:8000` にアクセス

### Railway.app へのデプロイ

本番環境は Railway.app にデプロイされています。

#### 初回デプロイ手順

1. Railway.app にログイン
2. 「New Project」→「Deploy from GitHub repo」
3. `suke146/shift-management` を選択
4. 自動的にビルド・デプロイが開始されます

#### データベースの初期化（Railway）

デプロイ後、Railwayのコンソールで以下を実行:

```bash
php init_db.php
```

#### スキーマ変更時の手順

データベーススキーマを変更した場合:

```bash
# 既存のテーブルを削除
php reset_db.php

# 新しいスキーマで再作成
php init_db.php
```

**注意**: `reset_db.php` を実行すると全てのデータが削除されます。

### 5. デフォルト管理者アカウント

初回ログイン用の管理者アカウント:
- メールアドレス: `admin@example.com`
- パスワード: `admin123`

**セキュリティのため、初回ログイン後にパスワードを変更することを推奨します。**

## 本番環境

本番環境URL: https://shift-management-production-778d.up.railway.app

- インターネット経由でどこからでもアクセス可能
- スマートフォン、タブレット対応
- HTTPSで暗号化通信

## ローカルネットワーク内からのアクセス

同じWi-Fi内の他のデバイスからアクセスする場合:

1. サーバーのローカルIPアドレスを確認:
   ```bash
   ipconfig  # Windows
   ifconfig  # Mac/Linux
   ```

2. PHPサーバーを外部アクセス可能に起動:
   ```bash
   php -S 0.0.0.0:8000
   ```

3. 同じネットワーク内の他のデバイスから `http://[サーバーのIP]:8000` でアクセス

## ファイル構成

```
shift_management/
├── index.php              # ログイン・新規登録ページ
├── dashboard.php          # メインダッシュボード
├── logout.php             # ログアウト処理
├── init_db.php            # データベース初期化スクリプト
├── reset_db.php           # データベースリセットスクリプト
├── check_db.php           # データベース確認ツール
├── Dockerfile             # Docker設定
├── config/
│   ├── db.php            # データベース接続設定（SQLite）
│   └── setup.sql         # データベーススキーマ定義
├── api/
│   ├── auth.php          # 認証API
│   ├── shift.php         # シフトAPI
│   └── admin.php         # 管理者API
├── css/
│   ├── style.css         # 共通スタイル
│   └── dashboard.css     # ダッシュボード用スタイル
├── js/
│   ├── auth.js           # 認証処理
│   ├── dashboard.js      # ダッシュボード制御
│   ├── shift.js          # シフト処理（半月ごと、15分刻み）
│   └── admin.js          # 管理者機能
└── data/
    └── shift_management.db  # SQLiteデータベースファイル
```

## 使用方法

### シフトの提出
1. ダッシュボードの「シフト提出」をクリック
2. 対象期間の日付を選択（選択した日付が含まれる半月期間のシフトを提出）
   - 1日～15日を選択 → 1日～15日のシフト
   - 16日～月末を選択 → 16日～月末のシフト
3. 勤務可能な日のチェックボックスをオンにし、時間を選択（15分刻み）
4. 「シフトを提出」ボタンをクリック

### シフトの閲覧
1. ダッシュボードの「シフト閲覧」をクリック
2. 「前の半月」「次の半月」ボタンで閲覧したい期間を選択
3. 確定したシフトが表形式で表示されます
4. 自分のシフトはハイライト表示されます

### 管理者機能
1. ダッシュボードの「シフト管理」で全員の提出を確認
2. 採用したいシフトにチェックを入れる
3. 「確定シフトを作成」ボタンで確定
4. 「メンバー管理」でユーザーの権限変更や削除が可能

## セキュリティについて

- パスワードは `password_hash()` で暗号化して保存
- セッション管理によるアクセス制御
- 管理者権限のチェック
- SQLインジェクション対策(プリペアドステートメント使用)
- XSS対策(`htmlspecialchars()` による出力エスケープ)

## トラブルシューティング

### データベース接続エラー
- SQLite拡張が有効か確認: `php -m | grep sqlite`
- `data` ディレクトリの書き込み権限を確認
- `init_db.php` を実行してデータベースを初期化

### ログインできない
- デフォルト管理者アカウントで試す（admin@example.com / admin123）
- ブラウザのキャッシュをクリア
- セッションファイルのパーミッションを確認

### シフトが表示されない
- ブラウザの開発者ツール（F12）でAPIエラーを確認
- `check_db.php` を実行してデータベースの内容を確認
- データベースにデータが登録されているか確認

### Railway デプロイ後の問題
- デプロイログを確認
- `php init_db.php` でデータベースを初期化
- 環境変数が正しく設定されているか確認

## 今後の拡張機能案

- メール通知機能
- シフト変更申請機能
- 勤務時間の集計・給与計算
- カレンダーエクスポート(iCal形式)
- スマホアプリ化
- LINE連携

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## サポート

問題が発生した場合は、開発者に連絡してください。
